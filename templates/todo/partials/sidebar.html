<aside class="sidebar" role="navigation" aria-label="Main navigation">
    {% if user.is_authenticated %}
    <div class="profile-section">
        {# UPDATED: Use the profile image #}
        <img src="{{ user.profile.image.url }}" class="profile-pic" alt="User profile picture">
        <div class="profile-info">
            <h3>{{ user.get_full_name|default:user.username }}</h3>
            <p>@{{ user.username }}</p>
        </div>
    </div>
    
    <nav class="sidebar-nav">
        <ul role="list">
            <!-- The 'active_page' variable will be passed from the view -->
            <li class="{% if active_page == 'dashboard' %}active{% endif %}">
                <a href="{% url 'dashboard' %}">
                    <i class="fas fa-th-large" aria-hidden="true"></i> Dashboard
                </a>
            </li>
            <li class="{% if active_page == 'vital_tasks' %}active{% endif %}">
                <a href="{% url 'vital_tasks' %}">
                    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Vital Task
                </a>
            </li>
            <li class="{% if active_page == 'my_tasks' %}active{% endif %}">
                <a href="{% url 'my_tasks' %}">
                    <i class="fas fa-tasks" aria-hidden="true"></i> My Task
                </a>
            </li>
            <li class="{% if active_page == 'task_categories' %}active{% endif %}">
                <a href="{% url 'task_categories' %}">
                    <i class="fas fa-list-alt" aria-hidden="true"></i> Task Categories
                </a>
            </li>
            <li class="{% if active_page == 'settings' %}active{% endif %}">
                <a href="{% url 'settings' %}">
                    <i class="fas fa-cog" aria-hidden="true"></i> Settings
                </a>
            </li>
            <li class="{% if active_page == 'help' %}active{% endif %}">
                <a href="{% url 'help' %}">
                    <i class="fas fa-question-circle" aria-hidden="true"></i> Help
                </a>
            </li>
        </ul>
    </nav>
    
    <div class="logout-btn">
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" aria-label="Logout">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
            </button>
        </form>
    </div>
    {% else %}
    <div class="login-prompt">
        <p>Please log in to manage your tasks.</p>
        <a href="{% url 'login' %}" class="btn-primary">Login</a>
    </div>
    {% endif %}
</aside>