{% extends 'todo/base.html' %}
{% load static %}

{% block title %}Task Categories - TaskMitra{% endblock title %}

{% block styles %}
    {# Link the page-specific stylesheet #}
    <link rel="stylesheet" href="{% static 'todo/css/task-categories.css' %}">
{% endblock styles %}

{% block content %}
<div class="category-header">
    <button class="invite-btn" id="add-category-btn" type="button" aria-label="Add new category">
        <i class="fas fa-plus"></i> Add Category
    </button>
</div>

<!-- Container for all category cards -->
<div id="category-cards-container">
    {% for category in categories %}
    <article class="category-card" style="--category-color: {{ category.color }};">
        <div class="category-header">
            <div class="category-icon"><i class="fas fa-folder"></i></div>
            <div class="category-info">
                <h3 class="category-name">{{ category.name }}</h3>
                <span class="category-task-count">{{ category.task_count }} Task{{ category.task_count|pluralize }}</span>
            </div>
            {# Add links for editing/deleting categories later #}
            <button class="task-menu-btn" aria-label="Category options"><i class="fas fa-ellipsis-v"></i></button>
        </div>
        <div class="category-progress">
            <p>Completion Progress</p>
            <div class="progress-bar-container">
                <div class="progress-bar" style="width: {{ category.progress }}%;"></div>
                <span class="progress-label">{{ category.progress }}%</span>
            </div>
        </div>
    </article>
    {% empty %}
    <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
        <div class="empty-icon"><i class="fas fa-folder-plus"></i></div>
        <h4>No Categories Yet</h4>
        <p>Click "Add Category" to start organizing your tasks.</p>
    </div>
    {% endfor %}
</div>

<!-- Add/Edit Category Modal -->
<div id="category-modal" class="task-modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-folder-plus"></i> Add New Category</h3>
            <button id="category-modal-close-btn" class="close-modal" aria-label="Close">&times;</button>
        </div>
        <form id="category-form" method="post" action="{% url 'category_create' %}">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label for="id_name"><i class="fas fa-tag"></i> Category Name *</label>
                    {{ form.name }}
                </div>
                <div class="form-group">
                    <label for="id_color"><i class="fas fa-palette"></i> Category Color</label>
                    {{ form.color }}
                </div>
            </div>
            <div class="modal-actions form-actions">
                <button type="button" class="btn-cancel" id="category-modal-cancel-btn">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-check"></i> Save Category
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock content %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const addCategoryBtn = document.getElementById('add-category-btn');
        const categoryModal = document.getElementById('category-modal');
        const closeModalBtn = document.getElementById('category-modal-close-btn');
        const cancelModalBtn = document.getElementById('category-modal-cancel-btn');

        if (!categoryModal) return;

        const openModal = () => {
            categoryModal.style.display = 'flex';
        };

        const closeModal = () => {
            categoryModal.style.display = 'none';
        };

        addCategoryBtn.addEventListener('click', openModal);
        closeModalBtn.addEventListener('click', closeModal);
        cancelModalBtn.addEventListener('click', closeModal);

        // Close modal if clicking on the overlay
        categoryModal.addEventListener('click', function(event) {
            if (event.target === categoryModal) {
                closeModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === "Escape") {
                closeModal();
            }
        });
    });
</script>
{% endblock scripts %}